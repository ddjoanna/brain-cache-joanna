# Redis 快取常見問題

> 以下是 Redis 快取常見的五種問題：快取雪崩、快取擊穿、快取穿透、快取預熱與快取降級的問題說明、情境說明與解決方案：

| 問題名稱     | 問題說明                                                                       | 情境說明                                              | 解決方案                                                                                                      |
| ------------ | ------------------------------------------------------------------------------ | ----------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| **快取雪崩** | 大量快取資料同時失效或快取服務宕機，導致大量請求直接打資料庫，造成壓力劇增。   | Redis 重啟、同一時間大量 key 過期、高併發下快取失效。 | - 設置不同且帶隨機值的過期時間- 建立 Redis 集群或多級快取- 熔斷限流保護資料庫- 熱點資料永不過期，異步更新快取 |
| **快取擊穿** | 單一熱門 key 過期瞬間，大量請求同時查詢該 key，導致資料庫壓力激增。            | 熱門資料快取過期，高併發請求瞬間落到資料庫。          | - 使用互斥鎖或分布式鎖避免同時查庫- 永不過期快取，異步更新- 預先加載熱門資料                                  |
| **快取穿透** | 查詢資料在快取和資料庫都不存在，未快取空結果，導致每次請求都打資料庫。         | 查詢不存在的 key，或惡意攻擊大量查詢不存在 key。      | - 快取空結果（空值快取）短時間- 使用 Bloom Filter 等過濾器過濾不存在 key- 加強驗證防攻擊                      |
| **快取預熱** | 系統啟動或快取重建後，提前將熱門資料加載到快取，避免首次請求延遲或壓力過大。   | 系統剛啟動，熱門資料尚未快取。                        | - 啟動時批量預熱熱門資料- 定期異步刷新快取- 使用定時任務或事件觸發更新                                        |
| **快取降級** | 快取不可用或壓力大時，系統降低快取依賴，直接讀資料庫或返回預設結果，避免崩潰。 | Redis 宕機、快取響應慢或無法承受高併發。              | - 熔斷限流，服務降級- 直接讀資料庫並返回降級資料- 多級快取保障部分快取可用- 監控快取狀態及時切換              |

---

## 快取雪崩（Cache Avalanche）

**問題說明**  
快取雪崩是指大量快取資料在同一時間大量失效（例如大量 key 同時過期）或快取服務宕機，導致大量請求直接打到後端資料庫，造成資料庫壓力劇增，甚至系統崩潰。

**情境說明**

- Redis 服務宕機或重啟。
- 設置了相同或非常接近過期時間的大量快取 key 同時過期。
- 高併發情況下，所有請求都無法命中快取，直接衝擊資料庫。

**解決方案**

- 為快取 key 設置不同的過期時間，加入隨機值，避免同時失效。
- 建立 Redis 集群或多級快取架構，提高快取可用性。
- 熔斷降級與限流，避免資料庫被瞬間打垮。
- 使用雙層快取策略（主快取與備份快取）。
- 熱點資料設定永不過期，並由後台異步更新快取[1][2][3][4][5][6]。

---

## 快取擊穿（Cache Breakdown）

**問題說明**  
快取擊穿是指某個熱門 key 在快取過期的瞬間，有大量請求同時查詢該 key，導致大量請求直接落到資料庫，造成資料庫壓力激增。

**情境說明**

- 單一熱門資料的快取過期。
- 高併發環境下大量請求同時查詢該 key。

**解決方案**

- 利用互斥鎖（mutex lock）或分布式鎖，確保同一時間只有一個線程去資料庫查詢並重建快取，其他線程等待。
- 使用永不過期的快取，並由後台線程異步更新快取。
- 預先加載熱門資料，避免快取突然失效[2][4][5][6]。

---

## 快取穿透（Cache Penetration）

**問題說明**  
快取穿透是指查詢的資料在快取和資料庫中都不存在，且查詢結果未被快取，導致每次請求都直接打到資料庫。

**情境說明**

- 查詢不存在的 key。
- 惡意攻擊者大量查詢不存在的 key，造成資料庫負載。

**解決方案**

- 對不存在的 key，將空結果快取一段短時間，避免重複查詢打到資料庫。
- 使用 Bloom Filter 等過濾器，先判斷 key 是否存在於資料庫中，若不存在直接返回，避免查資料庫。
- 加強驗證與防攻擊措施[4][6]。

---

## 快取預熱（Cache Warming）

**問題說明**  
快取預熱是指在系統啟動或快取重建後，提前將熱門資料加載到快取中，避免系統剛啟動時大量請求直接打資料庫。

**情境說明**

- 系統剛啟動或快取剛清空。
- 熱門資料尚未被快取，導致首次請求延遲或資料庫壓力大。

**解決方案**

- 啟動時由後台批量預先加載熱門資料到快取。
- 定期異步刷新熱門資料快取。
- 透過定時任務或事件觸發快取更新[2][4]。

---

## 快取降級（Cache Degradation）

**問題說明**  
當快取服務不可用或快取壓力過大時，系統主動降低快取依賴，直接使用資料庫或返回預設結果，避免系統崩潰。

**情境說明**

- Redis 宕機或響應過慢。
- 快取層無法承受高併發請求。

**解決方案**

- 實施服務熔斷機制，當快取不可用時限流或降級。
- 直接讀取資料庫，並返回預設或降級資料。
- 建立多級快取，保證部分快取可用。
- 監控快取狀態，及時切換降級方案[2][3][4][6]。

---

以上問題與解決方案是 Redis 快取系統設計中常見且關鍵的部分，合理應用這些策略可大幅提升系統穩定性與效能。

---

**參考來源:**

[1] https://blog.csdn.net/m0_62090480/article/details/140025179 \
[2] https://xiaolincoding.com/redis/cluster/cache_problem.html \
[3] https://www.cnblogs.com/crazymakercircle/p/18473797 \
[4] https://www.pixelstech.net/article/1586522853-what-is-cache-penetration-cache-breakdown-and-cache-avalanche?lang=chinese_traditional \
[5] https://github.com/CoderLeixiaoshuai/java-eight-part/blob/master/docs/redis/%E4%B8%80%E5%BC%A0%E5%9B%BE%E6%90%9E%E6%87%82Redis%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9%E3%80%81%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E3%80%81%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF.md \
[6] https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/26%20%20%E7%BC%93%E5%AD%98%E5%BC%82%E5%B8%B8%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9%E3%80%81%E5%87%BB%E7%A9%BF%E3%80%81%E7%A9%BF%E9%80%8F%E9%9A%BE%E9%A2%98%EF%BC%9F.md \
[7] https://blog.csdn.net/liuqingup/article/details/131275262

---

[返回目錄](./../README.md)
