# Kafka

## Kafka 運作原理

Kafka 是一個分布式流處理平台，主要用於高吞吐量、低延遲的消息傳遞和資料流管道建構。其運作基於「發布-訂閱」模式，生產者（Producer）將消息發送到指定的主題（Topic），消息被持久化存儲在分區（Partition）中，消費者（Consumer）從分區中拉取消息進行處理。

- **消息持久化**：Kafka 將消息持久化存儲在磁碟中，保證資料不丟失，並可設定消息保留時間（預設 3 天），支持消息重放。
- **分區與副本**：每個主題可分為多個分區，分區可跨多個 Broker 分佈，實現負載均衡與擴展性。分區內消息有序，跨分區無序。副本機制保證容錯性。
- **拉取式消費**：消費者主動從 Broker 拉取消息，並維護自己的消費位移（offset），可自由控制消費進度與重複消費。
- **消費組（Consumer Group）**：多個消費者組成消費組，共同消費主題消息，分區內消息由消費組內唯一消費者處理，實現負載均衡和容錯。

---

## Kafka 主要特性

- **高吞吐量與低延遲**：支持每秒數百萬條消息的處理，適合大規模資料流場景。
- **可擴展性強**：通過增加 Broker 和分區數量，線性擴展系統容量與性能。
- **持久化存儲與容錯**：消息持久化到磁碟，副本機制支持 Broker 故障自動切換，保證系統高可用。
- **靈活的消費模式**：支持點對點和發布訂閱兩種通訊模式，滿足不同應用需求。
- **消息重放與回溯**：消費者可根據 offset 重複消費消息，方便故障恢復與數據再處理。
- **支持流處理生態**：與 Apache Flink、Spark Streaming 等流處理框架無縫集成。

---

## Kafka 核心組件

| 組件               | 功能說明                                                                                |
| ------------------ | --------------------------------------------------------------------------------------- |
| **Broker**         | Kafka 伺服器節點，負責接收、存儲和轉發消息。多個 Broker 組成集群。                      |
| **Topic**          | 消息主題，消息的分類單位。每個 Topic 可分多個分區。                                     |
| **Partition**      | Topic 的子分區，消息在分區內有序存儲，分區可分佈在不同 Broker 上以實現負載均衡。        |
| **Producer**       | 生產者，負責向指定 Topic 發送消息。支持批量、壓縮和異步發送以提升性能。                 |
| **Consumer**       | 消費者，訂閱 Topic 並拉取消息進行處理。                                                 |
| **Consumer Group** | 消費者組，組內消費者協同消費 Topic 消息，分區內消息由組內唯一消費者消費，實現負載均衡。 |
| **Zookeeper**      | 用於管理 Kafka 集群的元數據、Broker 節點狀態和 Leader 選舉（新版 Kafka 逐步移除依賴）。 |

---

## Kafka 典型應用場景

- **消息隊列與系統解耦**  
  Kafka 作為可靠且高效的消息中間件，實現不同系統間異步通信和解耦，如訂單系統通知庫存系統。

- **日誌收集與分析**  
  集中收集分散系統和應用的日誌數據，供實時監控、故障排查和離線分析使用。

- **實時數據流處理**  
  用於網站點擊流、社交媒體分析、金融交易監控等場景，配合流處理框架實現實時數據分析和決策。

- **事件驅動架構（EDA）與事件溯源**  
  記錄微服務間事件，支持事件重放和系統恢復，促進微服務間的業務協調。

- **流量削峰與錯峰處理**  
  電商秒殺、搶票等高併發場景下，通過消息隊列緩衝突發流量，保護下游系統穩定。

---

**參考來源:**

[1] https://www.51cto.com/article/770859.html \
[2] https://ithelp.ithome.com.tw/articles/10264758 \
[3] https://carger.tips/%E8%81%8A%E8%81%8A-apache-kafka \
[4] https://help.aliyun.com/zh/apsaramq-for-kafka/cloud-message-queue-for-kafka/product-overview/use-scenarios \
[5] https://www.cnblogs.com/Leo_wl/articles/17910412.html \
[6] https://support.huaweicloud.com/productdesc-kafka/kafka-scenarios.html \
[7] https://vocus.cc/article/66057141fd89780001118051 \
[8] https://blog.csdn.net/2301_76166241/article/details/140673048

---

[返回目錄](./../README.md)
