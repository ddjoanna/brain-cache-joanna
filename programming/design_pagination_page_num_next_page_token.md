# 分頁設計

> 常見的兩種方式是使用「page num（頁碼分頁）」和「next page token（游標分頁）」，兩者在設計理念、使用方式及優缺點上有明顯差異。

## 設計差異

### Page Num（頁碼分頁）

- **設計方式**：以頁碼（如第 1 頁、第 2 頁）和每頁資料數量（pageSize）作為參數，前端請求特定頁碼的資料。
- **使用情境**：適合資料量較小或資料變動不頻繁的場景，且用戶需要直接跳轉到任意頁面。
- **實現簡單**：前端只需傳入頁碼和每頁大小，後端透過 OFFSET + LIMIT 查詢資料。

### Next Page Token（游標分頁）

- **設計方式**：後端返回一個「游標」或「token」，代表下一頁資料的起點，前端用此 token 請求下一批資料。
- **使用情境**：適合資料量大且資料頻繁變動的場景，避免因資料變動導致分頁錯亂。
- **實現方式**：token 通常是資料庫主鍵或某個排序欄位的加密值，代表下一頁的起始位置。

## 優缺點比較

| 特性           | Page Num（頁碼分頁）                                   | Next Page Token（游標分頁）                           |
| -------------- | ------------------------------------------------------ | ----------------------------------------------------- |
| **效能**       | 隨著頁碼增加，查詢時間線性增加（OFFSET 查詢成本高）[1] | 查詢時間穩定，直接走索引，不受頁碼影響[1]             |
| **跳頁能力**   | 可直接跳轉任意頁碼，靈活性高[3]                        | 只能順序翻頁，難以跳轉到任意頁[1][4]                  |
| **資料一致性** | 資料變動時可能導致資料重複或漏讀（因 OFFSET 固定位置） | 較能保持資料一致性，因為游標基於唯一排序鍵[4]         |
| **實作複雜度** | 簡單，前端只需傳頁碼，後端用 OFFSET + LIMIT            | 較複雜，需生成與解析 token，且 token 通常需加密[1][4] |
| **安全性**     | 無特殊安全需求                                         | token 需加密以防洩露資料量或敏感資訊[1]               |
| **狀態管理**   | 無需保存狀態，頁碼即狀態                               | 需要保存 token 狀態，且只能向前翻頁，回退較困難[1]    |
| **CPU 負擔**   | OFFSET 查詢對大資料集 CPU 負擔大                       | 加解密 token 有額外 CPU 開銷，但查詢效率高[1]         |

## 總結

- **Page Num 分頁**適合資料量較小、用戶需要自由跳頁的場景，實作簡單，但在大資料量或頻繁更新的資料庫中效能較差且可能導致資料不一致。
- **Next Page Token 分頁**適合大規模資料和高併發場景，查詢效率穩定且資料一致性較好，但不支援跳頁且實作較複雜，需要管理 token 的安全與狀態。

因此，選擇哪種分頁方式需根據具體業務需求、資料特性與使用者體驗做權衡[1][3][4]。

---

**參考來源:**

[1] https://davyjones2010.github.io/2022-03-28-openapi-nexttoken/ \
[2] https://tec.xenby.com/36-%E9%BE%90%E5%A4%A7%E8%B3%87%E6%96%99%E5%BA%AB%E5%88%86%E9%A0%81%E6%96%B9%E6%A1%88-cursor-based-pagination \
[3] https://ithelp.ithome.com.tw/articles/10278297 \
[4] https://github.com/isayme/blog/issues/29 \
[5] https://www.cnblogs.com/konglxblog/p/17003402.html \
[6] https://juejin.cn/post/6971052915502874631 \
[7] https://bootstrap5.hexschool.com/docs/5.1/components/pagination/ \
[8] http://search.taai.org.tw/paper/2021/0/%E5%9F%BA%E6%96%BC%E8%87%AA%E5%8B%95%E5%88%86%E9%A0%81%E9%A0%90%E6%B8%AC%E4%B9%8B%E5%A4%A7%E8%A6%8F%E6%A8%A1%E8%B3%87%E6%96%99%E6%87%89%E7%94%A8%E7%A8%8B%E5%BC%8F%E4%BB%8B%E9%9D%A2%E5%BB%BA%E7%BD%AE%20-%20%E4%BB%A5%E6%B4%BB%E5%8B%95%E6%93%B7%E5%8F%96%E7%82%BA%E4%BE%8B.pdf

---

[返回目錄](./../README.md)
